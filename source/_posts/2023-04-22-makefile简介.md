---
title: makefileç®€ä»‹
categories: [c++]
date: 2023-04-22
---

c++ make

<!--more-->

## ä¸€ã€ä¸ºä»€ä¹ˆè¦ç”¨ make

- ä¸€ä¸ªè¯æ¥è¯´å°±æ˜¯ï¼š**è‡ªåŠ¨åŒ–**
- åªéœ€è¦å†™ä¸€ä¸ª Makefileï¼Œå°±å¯ä»¥é€šè¿‡ä¸€å¥å‘½ä»¤æ¥è‡ªåŠ¨åŒ–åœ°å®Œæˆç¼–è¯‘ã€æµ‹è¯•ã€æ‰“åŒ…ã€éƒ¨ç½²ç­‰ä¸€ç³»åˆ—æ“ä½œ
  - å³ä½¿æ˜¯ Linux å†…æ ¸ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ä¸€å¥ make æ¥å®Œæˆç¼–è¯‘
- è€Œä¸”å®ƒä¸ä»…ä»…æ˜¯ç”¨æ¥ç¼–è¯‘ C/C++ çš„ï¼Œè¿˜å¯ä»¥ç”¨æ¥æ‰§è¡Œä»»ä½•å‘½ä»¤
  - æ¯”å¦‚è¯´ç”¨ make æ¥ç®€åŒ–è¾“å…¥å‘½ä»¤çš„
  - æœ‰äº›æ—¶å€™ä¼šæ¯” shell è„šæœ¬æ›´å®¹æ˜“ç¼–å†™
    - å¤„ç†ä¾èµ–ã€è¯»å–å‘½ä»¤è¡Œè¾“å…¥ç­‰ make éƒ½ä¼šå¸®ä½ å®Œæˆ

## [#](https://whfox.github.io/post/2023/04/22/makefileç®€ä»‹.html#äºŒã€å¦‚ä½•ç¼–å†™-makefile)äºŒã€å¦‚ä½•ç¼–å†™ Makefile

```makefile
target ...: prerequisites ...
    command
    ...
    ...
```

- target: ç›®æ ‡æ–‡ä»¶ / å¯æ‰§è¡Œæ–‡ä»¶/ æ ‡ç­¾

  - .PHONY å®šä¹‰ä¼ªç›®æ ‡

- prerequisites: ä¾èµ–æ–‡ä»¶ / ä¾èµ– target

- command: æ‰§è¡Œçš„å‘½ä»¤

  - å³è§¦å‘ target æ—¶æ‰§è¡Œçš„ shell å‘½ä»¤
  - å¼€å¤´åŠ  `@` ä¸ä¼šåœ¨ç»ˆç«¯è¾“å‡ºå‘½ä»¤æœ¬èº«
  - å¼€å¤´åŠ  `-` ä¼šå¿½ç•¥å‘½ä»¤æ‰§è¡Œå¤±è´¥çš„é”™è¯¯ï¼Œç»§ç»­å‘ä¸‹æ‰§è¡Œ

## [#](https://whfox.github.io/post/2023/04/22/makefileç®€ä»‹.html#ä¸‰ã€makefile-å˜é‡)ä¸‰ã€Makefile å˜é‡

- å˜é‡å®šä¹‰ï¼š
  - VAR = valueï¼Œvalue ä¼šåœ¨ä½¿ç”¨æ—¶æ‰è¢«å±•å¼€ï¼ˆå¯ä»¥åœ¨æ–‡ä»¶ä»»ä½•ä½ç½®ï¼‰
  - VAR := valueï¼Œå³è¾¹çš„ value ä¼šåœ¨å®šä¹‰æ—¶å°±è¢«å±•å¼€
  - VAR ?= valueï¼Œå¦‚æœ VAR æœªå®šä¹‰ï¼Œåˆ™å®šä¹‰ä¸º value
  - VAR += valueï¼Œå°† value è¿½åŠ åˆ° VAR çš„æœ«å°¾
- å˜é‡å¼•ç”¨ï¼š
  - $(VAR)ï¼šå¼•ç”¨å˜é‡ VARï¼ˆMakefile ä¸­çš„å˜é‡å¼•ç”¨ï¼‰
  - ${VAR}ï¼šå¼•ç”¨å˜é‡ VARï¼ˆShell ä¸­çš„å˜é‡å¼•ç”¨ï¼‰
  - ä¼šä»¥â€œå­—ç¬¦ä¸²â€çš„å½¢å¼å±•å¼€ï¼ˆç±»ä¼¼ C ä¸­çš„å®å±•å¼€ï¼‰
  - å¯ä»¥é€šè¿‡ $(shell command) æ¥å°† command çš„è¾“å‡ºç»“æœä½œä¸ºæ›¿æ¢çš„å€¼
  - å¯ä»¥ç›´æ¥ä½¿ç”¨ç¯å¢ƒå˜é‡ï¼Œå¦‚ $(PATH)

## [#](https://whfox.github.io/post/2023/04/22/makefileç®€ä»‹.html#å››ã€make-å‘½ä»¤)å››ã€make å‘½ä»¤

- make åé¢å¯ä»¥è·Ÿå¤šä¸ª targetï¼ŒæŒ‡å®šæ‰§è¡Œçš„å†…å®¹
  - å¦‚æœä¸è·Ÿä»»ä½• targetï¼Œåˆ™é»˜è®¤æ‰§è¡Œç¬¬ä¸€ä¸ª target
- å¯ä»¥åœ¨ make åé¢ç›´æ¥é€šè¿‡ `VAR=value` çš„å½¢å¼æ¥å®šä¹‰å˜é‡
  - ä¼˜å…ˆçº§ï¼šmake å > Makefile ä¸­å®šä¹‰ > ç¯å¢ƒå˜é‡ï¼ˆmake å‰ï¼‰
- ä¸€äº›å¸¸ç”¨çš„ make å‘½ä»¤ flagï¼š
  - make -f *FILE*ï¼šæŒ‡å®š Makefile æ–‡ä»¶
  - make -nï¼šä¸æ‰§è¡Œå‘½ä»¤ï¼Œåªæ˜¾ç¤ºå‘½ä»¤
  - make -sï¼šä¸æ˜¾ç¤ºå‘½ä»¤
  - make -j Nï¼šå¹¶è¡Œæ‰§è¡Œ N ä¸ªä»»åŠ¡
  - make -kï¼šå¿½ç•¥é”™è¯¯ï¼Œç»§ç»­æ‰§è¡Œ

## [#](https://whfox.github.io/post/2023/04/22/makefileç®€ä»‹.html#äº”ã€ç›¸å…³èµ„æ–™)äº”ã€ç›¸å…³èµ„æ–™

- ğŸ† å’Œæˆ‘ä¸€èµ·å†™ Makefileï¼š[seisman/how-to-write-makefile(opens new window)](https://seisman.github.io/how-to-write-makefile/)
- GNU make å®˜æ–¹æ–‡æ¡£ï¼š[GNU make](https://www.gnu.org/software/make/manual/make.html)